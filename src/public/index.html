<!DOCTYPE html>
<html>
	<head>
		<title>
			Chat with WebSocket
		</title>

		<link rel="stylesheet" href="style.css">

		<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.1/jquery.min.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.5.2/socket.io.js"></script>
	</head>

	<body>
		<form id="chat">
			<input type="text" name="username" placeholder="Type Your Username">
			<div class="messages"></div>
			<input type="text" name="message" placeholder="Type Your Message">
			<button type="submit">Send</button>
		</form>

		<script type="text/javascript">
			var socket = io('http://localhost:3000');

			function renderMessage(msgObj) {
				$('.messages').append(`
					<div class="message">
						<strong>${msgObj?.author}:</strong>
						<div>${msgObj?.message}</div>
					</div>
				`);
			}

			socket.on('previousMessages', function(messages) {
				for (message of messages) {
					renderMessage(message);
				}
			});

			// receive message from the server
			socket.on('receivedMessage', function(msgObj) {
				renderMessage(msgObj);
			});

			$('#chat').submit(function(event) {
				event.preventDefault();

				var author = $('input[name=username]').val();
				var message = $('input[name=message]').val();

				if (author?.length && message?.length) {
					var messageObject = {
						author: author,
						message: message,
					};

					// send message to the server
					renderMessage(messageObject);
					socket.emit('sendMessage', messageObject);
				}
			});
		</script>
	</body>
</html>
